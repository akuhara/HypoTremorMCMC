# Step 3. Measure and Optimize Time- and Amplitude-difference

The `hypo_tremor_measure` program processes the correlation files named 
`<station name 1>.<station name 2>.corr` and `<station name 1>.<statsion name 2>.max_corr`, 
which are generated by the `hypo_tremor_correlate` program.
This processing involves calculating relative arrival times and log-amplitude values. 
To achieve this, the program begins by analyzing the histogram of cross-correlation values, 
and it establishes a threshold specific to each station pair.
This threshold is determined by selecting an arbitrary percentile from the histogram, 
which users can customize using the _alpha_ parameter.

For each time segment, defined by _t_step_corr_ in the previous step, 
the program counts the number of station pairs where the maximum correlation value exceeds the specified threshold.
If this count surpasses a defined threshold, denoted as _n_pair_thred_, 
the program proceeds to calculate the relative time and amplitude for that particular time segment.

The output files are as follows: 

## opt_data._dddddd_.dat

Each row in this file presents relative arrival time and amplitude information at a station in the following format:

* Columns 1-3: Station coordinates (X, Y, Z) in kilometers.
* Column 4: Relative arrival time in seconds.
* Column 5: Standard deviation of the error on relative arrival time in seconds.
* Column 6: Relative log-amplitude.
* Column 7: Standard deviation of the error on relative log-amplitude.

## detected_win.dat

In this file, each row represents a time segment that meets the thresholding criteria and is formatted as follows:

Column 1: The assigned number of the time segment.
Column 2: The start time of the time segment relative to the beginning of the entire dataset in seconds.

## Required Parameters

The following parameters must appear in the [parameter file](parameter_file.md). 

__n_procs__
Number of processes for MPI parallel computation. This value must be equal to the one you specify in the command line. The purpose of this parameter is to prevent unintended number specified in the command line, which for some programs results in unintended results.

__station_file__
Absolute or relative path to a [station file](station_file.md) that lists station names, their position (X-Y-Z), and sensitivities of two horizontal components.

__alpha__        
Percentile on the cross-correlation histogram, specifying the cross-correlation value required for tremor detection (0.0 <= alpha < 1.0)

__n_pair_thred__  
The number of station pairs that meet the cross-correlation requirement for tremor detection.

